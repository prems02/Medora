<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Manual Conversation Capture Test - Cliqpat</title>\n    <style>\n        body { \n            font-family: Arial, sans-serif; \n            max-width: 800px; \n            margin: 50px auto; \n            padding: 20px;\n            background: #f8f9fa;\n        }\n        .container {\n            background: white;\n            padding: 30px;\n            border-radius: 12px;\n            box-shadow: 0 4px 12px rgba(0,0,0,0.1);\n        }\n        h1 { color: #333; text-align: center; margin-bottom: 30px; }\n        .form-group { margin-bottom: 20px; }\n        label { \n            display: block; \n            margin-bottom: 8px; \n            font-weight: 600;\n            color: #333;\n        }\n        input, textarea {\n            width: 100%;\n            padding: 12px;\n            border: 1px solid #ddd;\n            border-radius: 6px;\n            font-size: 14px;\n        }\n        textarea {\n            min-height: 150px;\n            resize: vertical;\n        }\n        button {\n            background: #28a745;\n            color: white;\n            padding: 12px 30px;\n            border: none;\n            border-radius: 6px;\n            cursor: pointer;\n            font-size: 16px;\n            margin: 10px 5px;\n            transition: background 0.3s;\n        }\n        button:hover { background: #218838; }\n        .test-btn { background: #007bff; }\n        .test-btn:hover { background: #0056b3; }\n        .clear-btn { background: #6c757d; }\n        .clear-btn:hover { background: #545b62; }\n        .result {\n            margin-top: 20px;\n            padding: 15px;\n            border-radius: 6px;\n            white-space: pre-wrap;\n            font-family: monospace;\n            font-size: 13px;\n        }\n        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }\n        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }\n        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }\n        .example {\n            background: #f8f9fa;\n            border: 1px solid #e9ecef;\n            padding: 15px;\n            border-radius: 6px;\n            margin-bottom: 20px;\n        }\n        .example h4 {\n            margin-top: 0;\n            color: #495057;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        <h1>üß™ Manual Conversation Capture Test</h1>\n        \n        <div class=\"example\">\n            <h4>üí° How to Use:</h4>\n            <p>This page helps you test the conversation capture system manually. Fill in the form below and click \"Capture Conversation\" to simulate what happens when an ElevenLabs call ends.</p>\n        </div>\n        \n        <form id=\"captureForm\">\n            <div class=\"form-group\">\n                <label for=\"appointmentId\">Appointment ID *</label>\n                <input type=\"text\" id=\"appointmentId\" value=\"test-manual-capture-\" required>\n                <small style=\"color: #666; font-size: 12px;\">Use a unique ID for each test</small>\n            </div>\n            \n            <div class=\"form-group\">\n                <label for=\"patientName\">Patient Name *</label>\n                <input type=\"text\" id=\"patientName\" value=\"Test Patient\" required>\n            </div>\n            \n            <div class=\"form-group\">\n                <label for=\"consultationSummary\">Consultation Summary *</label>\n                <textarea id=\"consultationSummary\" required placeholder=\"Enter the conversation summary or transcript here...\">Patient: Hello, I've been having headaches for the past 3 days.\n\nAI Doctor: I understand you're experiencing headaches. Can you tell me more about the pain? Is it constant or intermittent?\n\nPatient: It's mostly throbbing pain in the front of my head, worse in the mornings.\n\nAI Doctor: On a scale of 1-10, how would you rate the pain intensity?\n\nPatient: I'd say about a 6 or 7 out of 10 when it's at its worst.\n\nAI Doctor: Have you tried any medications or noticed any triggers?\n\nPatient: I took some ibuprofen but it only helped a little. I've been more stressed at work lately.\n\nAI Doctor: Stress can definitely contribute to tension headaches. Based on your symptoms, I recommend consulting with a healthcare provider for a proper evaluation.</textarea>\n            </div>\n            \n            <div class=\"form-group\">\n                <label for=\"callDuration\">Call Duration</label>\n                <input type=\"text\" id=\"callDuration\" value=\"4-5 minutes\">\n            </div>\n            \n            <div style=\"text-align: center; margin-top: 30px;\">\n                <button type=\"button\" onclick=\"generateTestData()\" class=\"test-btn\">üé≤ Generate Test Data</button>\n                <button type=\"submit\">üìû Capture Conversation</button>\n                <button type=\"button\" onclick=\"clearForm()\" class=\"clear-btn\">üóëÔ∏è Clear Form</button>\n            </div>\n        </form>\n        \n        <div id=\"result\"></div>\n    </div>\n\n    <script>\n        // Generate random test data\n        function generateTestData() {\n            const timestamp = Date.now();\n            document.getElementById('appointmentId').value = `test-${timestamp}`;\n            document.getElementById('patientName').value = `Test Patient ${Math.floor(Math.random() * 100)}`;\n            \n            const sampleConversations = [\n                `Patient: I have been feeling dizzy and nauseous for the past 2 days.\\n\\nAI Doctor: I'm sorry to hear you're feeling unwell. Can you describe when the dizziness occurs most?\\n\\nPatient: It happens mostly when I stand up quickly or turn my head.\\n\\nAI Doctor: That sounds like it could be related to position changes. Have you had any recent changes in medication or diet?\\n\\nPatient: No changes in medication, but I haven't been drinking much water lately.\\n\\nAI Doctor: Dehydration can contribute to dizziness. I recommend increasing your fluid intake and consulting with a healthcare provider if symptoms persist.`,\n                \n                `Patient: I have a persistent cough that's been bothering me for over a week.\\n\\nAI Doctor: I understand you have a persistent cough. Is it a dry cough or are you producing any phlegm?\\n\\nPatient: It's mostly dry, especially at night. It's keeping me awake.\\n\\nAI Doctor: Night coughs can be quite disruptive. Have you been around anyone who's been sick recently?\\n\\nPatient: My coworker had a cold last week, but this feels different.\\n\\nAI Doctor: It's important to monitor your symptoms. If the cough persists or you develop fever, I recommend seeing a healthcare provider for evaluation.`,\n                \n                `Patient: I'm experiencing chest pain, especially when I take deep breaths.\\n\\nAI Doctor: Chest pain is a symptom that needs attention. Can you describe the pain - is it sharp, dull, or pressure-like?\\n\\nPatient: It's more of a sharp pain on the left side when I breathe deeply or cough.\\n\\nAI Doctor: When did this pain start, and have you had any recent injuries or illness?\\n\\nPatient: It started yesterday after I went for a long run. I'm not used to that much exercise.\\n\\nAI Doctor: Exercise-related chest pain should be evaluated by a healthcare provider. If the pain worsens or you experience shortness of breath, seek immediate medical attention.`\n            ];\n            \n            const randomConversation = sampleConversations[Math.floor(Math.random() * sampleConversations.length)];\n            document.getElementById('consultationSummary').value = randomConversation;\n            document.getElementById('callDuration').value = `${Math.floor(Math.random() * 5) + 3}-${Math.floor(Math.random() * 3) + 5} minutes`;\n        }\n        \n        // Clear form\n        function clearForm() {\n            document.getElementById('captureForm').reset();\n            document.getElementById('result').innerHTML = '';\n        }\n        \n        // Handle form submission\n        document.getElementById('captureForm').addEventListener('submit', async function(e) {\n            e.preventDefault();\n            \n            const appointmentId = document.getElementById('appointmentId').value;\n            const patientName = document.getElementById('patientName').value;\n            const consultationSummary = document.getElementById('consultationSummary').value;\n            const callDuration = document.getElementById('callDuration').value;\n            \n            if (!appointmentId || !patientName || !consultationSummary) {\n                showResult('Please fill in all required fields.', 'error');\n                return;\n            }\n            \n            // Prepare conversation data using consultation_summary field\n            const conversationData = {\n                consultation_summary: `[Manual Test Capture at ${new Date().toLocaleString()}]\\n\\n${consultationSummary}\\n\\nCall Duration: ${callDuration}\\nSource: Manual Test Capture\\nTest ID: ${appointmentId}`,\n                appointment_id: appointmentId,\n                patient_name: patientName,\n                call_duration: callDuration || 'Unknown',\n                source: 'Manual_Test_Capture',\n                test_mode: true,\n                captured_at: new Date().toISOString()\n            };\n            \n            showResult('üì§ Sending conversation data to webhook...', 'info');\n            \n            try {\n                const response = await fetch('/api/webhook/elevenlabs-conversation', {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json'\n                    },\n                    body: JSON.stringify(conversationData)\n                });\n                \n                const result = await response.json();\n                \n                if (response.ok) {\n                    showResult(`‚úÖ SUCCESS! Conversation captured successfully:\\n\\n${JSON.stringify(result, null, 2)}\\n\\nü§ñ Now testing AI report generation...`, 'success');\n                    \n                    // Test AI report generation\n                    setTimeout(async () => {\n                        try {\n                            const reportResponse = await fetch(`/api/webhook/generate-ai-report/${appointmentId}`);\n                            const reportResult = await reportResponse.json();\n                            \n                            if (reportResponse.ok) {\n                                showResult(`‚úÖ COMPLETE SUCCESS! Both conversation capture and AI report generation work!\\n\\nüìä Conversation Storage Result:\\n${JSON.stringify(result, null, 2)}\\n\\nü§ñ AI Report Result:\\n${JSON.stringify(reportResult.data, null, 2)}`, 'success');\n                            } else {\n                                showResult(`‚úÖ Conversation captured successfully, but AI report failed:\\n\\nConversation: ${JSON.stringify(result, null, 2)}\\n\\n‚ùå Report Error: ${reportResult.message}`, 'error');\n                            }\n                        } catch (reportError) {\n                            showResult(`‚úÖ Conversation captured successfully, but AI report generation had an error:\\n\\nConversation: ${JSON.stringify(result, null, 2)}\\n\\n‚ùå Report Error: ${reportError.message}`, 'error');\n                        }\n                    }, 2000);\n                } else {\n                    showResult(`‚ùå FAILED to capture conversation:\\n\\n${JSON.stringify(result, null, 2)}`, 'error');\n                }\n            } catch (error) {\n                showResult(`‚ùå ERROR: ${error.message}\\n\\nMake sure the server is running on port 5000.`, 'error');\n            }\n        });\n        \n        // Show result\n        function showResult(message, type) {\n            const resultDiv = document.getElementById('result');\n            resultDiv.innerHTML = message;\n            resultDiv.className = `result ${type}`;\n        }\n        \n        // Auto-generate initial test data\n        window.addEventListener('load', function() {\n            document.getElementById('appointmentId').value += Date.now();\n        });\n    </script>\n</body>\n</html>
